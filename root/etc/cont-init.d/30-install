#!/usr/bin/with-contenv bash

# Clone directory, If Directory Exists, Git Pull
if [[ ! -d /config/www/monitorr/.git ]]; then
  git clone -b docker-develop --single-branch https://github.com/Monitorr/monitorr.git /config/www/monitorr
elif [[ -d /config/www/monitorr/.git ]]; then
  cd /config/www/monitorr || return
  git pull
fi

# Make Directories
# USER DATA
if [[ ! -d /app/userdata/ ]]; then
  mkdir /app/userdata/ # Dir for User Data
elif [[ -d /app/userdata/ ]]; then
  echo NOTIFY: The Directory /app/userdata/ already exists 1>&2
else
  :
fi

# Data Dir File
if [[ ! -e /config/www/monitorr/assets/data/datadir.json ]]; then
  cp /datadir.json /config/www/monitorr/assets/data/datadir.json # copy data dir
elif [[ -e /config/www/monitorr/assets/data/datadir.json ]]; then
  echo NOTIFY: The File /config/www/monitorr/assets/data/datadir.json already exists 1>&2
else
  :
fi

# Data Dir File
if [[ ! -e /app/userdata/monitorr_data_directory.txt ]]; then
  cp /config/www/monitorr/assets/config/_installation/default/monitorr_data_directory_default.txt /app/userdata/monitorr_data_directory.txt
elif [[ -e /app/userdata/monitorr_data_directory.txt ]]; then
  echo NOTIFY: The File /app/userdata/monitorr_data_directory.txt  already exists 1>&2
else
  :
fi

# Permissions
chown -R abc:abc /config
chown -R abc:abc /app
chmod 777 /app/userdata/monitorr_data_directory.txt
chmod 777 /config/www/monitorr/assets/data/datadir.json
